{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useReducer, useCallback } from \"react\";\nimport debounce from \"lodash/debounce\";\nconst INTERSECTION_THRESHOLD = 5;\nconst LOAD_DELAY_MS = 500;\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case \"set\":\n      {\n        return { ...state,\n          ...action.payload\n        };\n      }\n\n    case \"onGrabData\":\n      {\n        return { ...state,\n          loading: false,\n          data: [...state.data, ...action.payload.data],\n          currentPage: state.currentPage + 1\n        };\n      }\n\n    default:\n      return state;\n  }\n};\n\nconst useLazyLoad = ({\n  triggerRef,\n  onGrabData,\n  options\n}) => {\n  _s();\n\n  const [state, dispatch] = useReducer(reducer, {\n    loading: false,\n    currentPage: 1,\n    data: []\n  });\n\n  const _handleEntry = async entry => {\n    const boundingRect = entry.boundingClientRect;\n    const intersectionRect = entry.intersectionRect;\n\n    if (!state.loading && entry.isIntersecting && intersectionRect.bottom - boundingRect.bottom <= INTERSECTION_THRESHOLD) {\n      dispatch({\n        type: \"set\",\n        payload: {\n          loading: true\n        }\n      });\n      const data = await onGrabData(state.currentPage);\n      dispatch({\n        type: \"onGrabData\",\n        payload: {\n          data\n        }\n      });\n    }\n  };\n\n  const handleEntry = debounce(_handleEntry, LOAD_DELAY_MS);\n  const onIntersect = useCallback(entries => {\n    handleEntry(entries[0]);\n  }, [handleEntry]);\n  useEffect(() => {\n    if (triggerRef.current) {\n      const container = triggerRef.current;\n      const observer = new IntersectionObserver(onIntersect, options);\n      observer.observe(container);\n      return () => {\n        observer.disconnect();\n      };\n    }\n  }, [triggerRef, onIntersect, options]);\n  return state;\n};\n\n_s(useLazyLoad, \"17ojoto1N2a+Ra/F8xoOcDD44FU=\");\n\nexport default useLazyLoad;","map":{"version":3,"sources":["/Users/danielmendes/Documents/happypet/src/hooks/useLazyLoad.ts"],"names":["useEffect","useReducer","useCallback","debounce","INTERSECTION_THRESHOLD","LOAD_DELAY_MS","reducer","state","action","type","payload","loading","data","currentPage","useLazyLoad","triggerRef","onGrabData","options","dispatch","_handleEntry","entry","boundingRect","boundingClientRect","intersectionRect","isIntersecting","bottom","handleEntry","onIntersect","entries","current","container","observer","IntersectionObserver","observe","disconnect"],"mappings":";;AAAA,SAASA,SAAT,EAAoBC,UAApB,EAAgCC,WAAhC,QAAmD,OAAnD;AACA,OAAOC,QAAP,MAAqB,iBAArB;AAEA,MAAMC,sBAAsB,GAAG,CAA/B;AACA,MAAMC,aAAa,GAAG,GAAtB;;AAEA,MAAMC,OAAO,GAAG,CAACC,KAAD,EAAaC,MAAb,KAA6B;AAC3C,UAAQA,MAAM,CAACC,IAAf;AACE,SAAK,KAAL;AAAY;AACV,eAAO,EACL,GAAGF,KADE;AAEL,aAAGC,MAAM,CAACE;AAFL,SAAP;AAID;;AACD,SAAK,YAAL;AAAmB;AACjB,eAAO,EACL,GAAGH,KADE;AAELI,UAAAA,OAAO,EAAE,KAFJ;AAGLC,UAAAA,IAAI,EAAE,CAAC,GAAGL,KAAK,CAACK,IAAV,EAAgB,GAAGJ,MAAM,CAACE,OAAP,CAAeE,IAAlC,CAHD;AAILC,UAAAA,WAAW,EAAEN,KAAK,CAACM,WAAN,GAAoB;AAJ5B,SAAP;AAMD;;AACD;AACE,aAAON,KAAP;AAhBJ;AAkBD,CAnBD;;AAqBA,MAAMO,WAAW,GAAG,CAAC;AAAEC,EAAAA,UAAF;AAAcC,EAAAA,UAAd;AAA0BC,EAAAA;AAA1B,CAAD,KAA8C;AAAA;;AAChE,QAAM,CAACV,KAAD,EAAQW,QAAR,IAAoBjB,UAAU,CAACK,OAAD,EAAU;AAC5CK,IAAAA,OAAO,EAAE,KADmC;AAE5CE,IAAAA,WAAW,EAAE,CAF+B;AAG5CD,IAAAA,IAAI,EAAE;AAHsC,GAAV,CAApC;;AAMA,QAAMO,YAAY,GAAG,MAAOC,KAAP,IAAsB;AACzC,UAAMC,YAAY,GAAGD,KAAK,CAACE,kBAA3B;AACA,UAAMC,gBAAgB,GAAGH,KAAK,CAACG,gBAA/B;;AAEA,QACE,CAAChB,KAAK,CAACI,OAAP,IACAS,KAAK,CAACI,cADN,IAEAD,gBAAgB,CAACE,MAAjB,GAA0BJ,YAAY,CAACI,MAAvC,IAAiDrB,sBAHnD,EAIE;AACAc,MAAAA,QAAQ,CAAC;AAAET,QAAAA,IAAI,EAAE,KAAR;AAAeC,QAAAA,OAAO,EAAE;AAAEC,UAAAA,OAAO,EAAE;AAAX;AAAxB,OAAD,CAAR;AACA,YAAMC,IAAI,GAAG,MAAMI,UAAU,CAACT,KAAK,CAACM,WAAP,CAA7B;AACAK,MAAAA,QAAQ,CAAC;AAAET,QAAAA,IAAI,EAAE,YAAR;AAAsBC,QAAAA,OAAO,EAAE;AAAEE,UAAAA;AAAF;AAA/B,OAAD,CAAR;AACD;AACF,GAbD;;AAcA,QAAMc,WAAW,GAAGvB,QAAQ,CAACgB,YAAD,EAAed,aAAf,CAA5B;AAEA,QAAMsB,WAAW,GAAGzB,WAAW,CAC5B0B,OAAD,IAAa;AACXF,IAAAA,WAAW,CAACE,OAAO,CAAC,CAAD,CAAR,CAAX;AACD,GAH4B,EAI7B,CAACF,WAAD,CAJ6B,CAA/B;AAOA1B,EAAAA,SAAS,CAAC,MAAM;AACd,QAAIe,UAAU,CAACc,OAAf,EAAwB;AACtB,YAAMC,SAAS,GAAGf,UAAU,CAACc,OAA7B;AACA,YAAME,QAAQ,GAAG,IAAIC,oBAAJ,CAAyBL,WAAzB,EAAsCV,OAAtC,CAAjB;AAEAc,MAAAA,QAAQ,CAACE,OAAT,CAAiBH,SAAjB;AAEA,aAAO,MAAM;AACXC,QAAAA,QAAQ,CAACG,UAAT;AACD,OAFD;AAGD;AACF,GAXQ,EAWN,CAACnB,UAAD,EAAaY,WAAb,EAA0BV,OAA1B,CAXM,CAAT;AAaA,SAAOV,KAAP;AACD,CA5CD;;GAAMO,W;;AA8CN,eAAeA,WAAf","sourcesContent":["import { useEffect, useReducer, useCallback } from \"react\";\nimport debounce from \"lodash/debounce\";\n\nconst INTERSECTION_THRESHOLD = 5;\nconst LOAD_DELAY_MS = 500;\n\nconst reducer = (state: any, action: any) => {\n  switch (action.type) {\n    case \"set\": {\n      return {\n        ...state,\n        ...action.payload\n      };\n    }\n    case \"onGrabData\": {\n      return {\n        ...state,\n        loading: false,\n        data: [...state.data, ...action.payload.data],\n        currentPage: state.currentPage + 1\n      };\n    }\n    default:\n      return state;\n  }\n};\n\nconst useLazyLoad = ({ triggerRef, onGrabData, options }: any) => {\n  const [state, dispatch] = useReducer(reducer, {\n    loading: false,\n    currentPage: 1,\n    data: []\n  });\n\n  const _handleEntry = async (entry: any) => {\n    const boundingRect = entry.boundingClientRect;\n    const intersectionRect = entry.intersectionRect;\n\n    if (\n      !state.loading &&\n      entry.isIntersecting &&\n      intersectionRect.bottom - boundingRect.bottom <= INTERSECTION_THRESHOLD\n    ) {\n      dispatch({ type: \"set\", payload: { loading: true } });\n      const data = await onGrabData(state.currentPage);\n      dispatch({ type: \"onGrabData\", payload: { data } });\n    }\n  };\n  const handleEntry = debounce(_handleEntry, LOAD_DELAY_MS);\n\n  const onIntersect = useCallback(\n    (entries) => {\n      handleEntry(entries[0]);\n    },\n    [handleEntry]\n  );\n\n  useEffect(() => {\n    if (triggerRef.current) {\n      const container = triggerRef.current;\n      const observer = new IntersectionObserver(onIntersect, options);\n\n      observer.observe(container);\n\n      return () => {\n        observer.disconnect();\n      };\n    }\n  }, [triggerRef, onIntersect, options]);\n\n  return state;\n};\n\nexport default useLazyLoad;\n"]},"metadata":{},"sourceType":"module"}